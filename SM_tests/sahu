# Generated by Selenium IDE
import pytest
import chromedriver_binary
import time
from selenium.webdriver import ActionChains
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.common.exceptions import NoSuchElementException
from mimesis import Person
from mimesis import Address
from mimesis import Text
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as ec
from termcolor import colored
from selenium.common.exceptions import TimeoutException


def mimesis_form_fields():
    user = Person('ru')
    dealern = user.full_name()
    address = Address('ru')
    comment_init = Text('ru')
    comment = comment_init.sentence()
    city = address.city()
    phone = user.telephone(mask='(063) 123-45-67', placeholder='#')
    email = user.email()
    return city, dealern, email, phone, comment


class TestFormsSanahunt:
    def setup_method(self, method):
        self.vars = {}
        self.driver = webdriver.Chrome()

    def teardown_method(self, method):
        driver = self.driver
        driver.quit()

    def test_subscribe_newsletter_form(self):
        driver = self.driver
        city, dealern, email, phone, comment = mimesis_form_fields()
        driver.get("http://sanahunt.wezom.agency/")
        driver.maximize_window()
        time.sleep(2)
        driver.find_element(By.CSS_SELECTOR, ".newsletter-form .form-group__input[name='email']").click()
        driver.find_element(By.CSS_SELECTOR, ".newsletter-form .form-group__input[name='email']").send_keys(email)
        button = WebDriverWait(driver, 10).until(
            ec.element_to_be_clickable((By.CSS_SELECTOR, ".newsletter-form .button[type='submit']")))
        button.click()
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
            driver.find_element(By.CSS_SELECTOR, ".swal2-container .swal2-confirm").click()
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            print("\nEnd of email subscription testing\nGoing further...")
        time.sleep(4)
        driver.find_element(By.XPATH,
                            "//*[@id='mm-0']/div[2]/footer/div[1]/div/div[2]/div/div[2]/div[2]/div[2]/div[1]/span[3]").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".newsletter .wstabs-block.is-active .form-group__input[name='phone']").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".newsletter .wstabs-block.is-active .form-group__input[name='phone']").send_keys(phone)
        time.sleep(5)
        button = WebDriverWait(driver, 10).until(
            ec.element_to_be_clickable((By.CSS_SELECTOR, ".newsletter .wstabs-block.is-active .button[type='submit']")))
        button.click()
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
            driver.find_element(By.CSS_SELECTOR, ".swal2-container .swal2-confirm").click()
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            time.sleep(5)
            print("\nEnd of phone subscription testing")

    def test_fill_contact_us(self):
        driver = self.driver
        driver.get("http://sanahunt.wezom.agency/public/contacts")
        driver.implicitly_wait(5)
        driver.maximize_window()
        city, dealern, email, phone, comment = mimesis_form_fields()
        time.sleep(2)
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='username']").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='username']").send_keys(dealern)
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='phone']").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='phone']").send_keys(phone)
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='email']").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__input[name='email']").send_keys(email)
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__textarea").click()
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback form.form .form-group__textarea").send_keys(comment)
        driver.find_element(By.CSS_SELECTOR,
                            ".contacts-feedback .form-group--last button.button[type='submit']").click()
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
            driver.find_element(By.CSS_SELECTOR, ".swal2-container .swal2-confirm").click()
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            time.sleep(5)
            print("\nEnd of contact form testing")

    def test_fill_questions(self):
        driver = self.driver
        driver.get("http://sanahunt.wezom.agency/vacancies")
        driver.implicitly_wait(5)
        driver.maximize_window()
        city, dealern, email, phone, comment = mimesis_form_fields()
        time.sleep(2)
        insta_list = driver.find_element(By.CSS_SELECTOR, ".page-bottom")
        question_list = driver.find_element(By.CSS_SELECTOR, ".question .question-link")
        actions = ActionChains(driver)
        actions.move_to_element(insta_list).perform()
        question_list.click()
        time.sleep(3)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']") \
            .send_keys(dealern)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']") \
            .send_keys(phone)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").send_keys(email)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").send_keys(comment)
        # driver.find_element(By.ID, "vacancies-files").send_keys('C:\\JG\\cube.png')
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form button.button[type='submit']").click()
        time.sleep(5)
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
            driver.find_element(By.CSS_SELECTOR, ".swal2-container .swal2-confirm").click()
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            time.sleep(5)
            print("\nEnd of question form testing")

    def test_fill_vacancies(self):
        driver = self.driver
        driver.get("http://sanahunt.wezom.agency/vacancies")
        driver.implicitly_wait(5)
        driver.maximize_window()
        city, dealern, email, phone, comment = mimesis_form_fields()
        time.sleep(2)
        # vacancy form testing
        print("\nTesting vacancy form...")
        driver.find_element(By.CSS_SELECTOR, ".vacancies-list .vacancies-title").click()
        time.sleep(1)
        actions = ActionChains(driver)
        actions.move_to_element(
            driver.find_element(By.CSS_SELECTOR, ".vacancies-list__text.is-active .vacancies-list__button")).perform()
        driver.find_element(By.CSS_SELECTOR, ".vacancies-list__text.is-active .vacancies-list__button").click()
        time.sleep(3)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']") \
            .send_keys(dealern)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']") \
            .send_keys(phone)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").send_keys(email)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").send_keys(comment)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form  .form-file input[name='file']") \
            .send_keys('C:\\JG\\files_huge\\CV.zip')
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form button.button[type='submit']").click()
        time.sleep(5)
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
            driver.find_element(By.CSS_SELECTOR, ".swal2-container .swal2-confirm").click()
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            time.sleep(5)
            print("\nEnd of vacancy form testing")

    def test_fill_service_form(self):
        driver = self.driver
        driver.get("http://sanahunt.wezom.agency/services/made-to-measure")
        driver.implicitly_wait(5)
        driver.maximize_window()
        city, dealern, email, phone, comment = mimesis_form_fields()
        time.sleep(2)
        feedback_block = driver.find_element(By.CSS_SELECTOR, ".post-feedback")
        feedback_btn = driver.find_element(By.CSS_SELECTOR, ".post-feedback .button")
        actions = ActionChains(driver)
        actions.move_to_element(feedback_block).perform()
        feedback_btn.click()
        time.sleep(3)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='username']") \
            .send_keys(dealern)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='phone']") \
            .send_keys(phone)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__input[name='email']").send_keys(email)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").click()
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form .form-group__textarea").send_keys(comment)
        driver.find_element(By.CSS_SELECTOR, ".mfp-content form.form button.button[type='submit']").click()
        try:
            waiter_notification = WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.XPATH, "//*[@id='swal2-title']")))
            time.sleep(1)
            waiter_notification_text = waiter_notification.text
            print(colored("\n" + waiter_notification_text, 'green'))
        except NoSuchElementException:
            print("\nNo Notification message")
        finally:
            time.sleep(5)
            print("\nEnd of service form testing")


class TestCartFormsSanahunt:
    def setup_method(self, method):
        self.vars = {}
        self.driver = webdriver.Chrome()

    def teardown_method(self, method):
        driver = self.driver
        driver.quit()

    def test_login(self):
        driver = self.driver
        time.sleep(2)
        driver.find_element(By.CSS_SELECTOR, ".header-user-button").click()
        driver.find_element(By.CSS_SELECTOR, ".form-auth .form-group__input[name='login']").click()
        driver.find_element(By.CSS_SELECTOR, ".form-auth .form-group__input[name='login']").send_keys(
            "kozachinskii.e.wezom@gmail.com")
        driver.find_element(By.CSS_SELECTOR, ".form-auth .form-group__input[name='password']").click()
        driver.find_element(By.CSS_SELECTOR, ".form-auth .form-group__input[name='password']").send_keys("Gbhfvblf1")
        driver.find_element(By.CSS_SELECTOR, ".form-auth .button[type='submit']").click()

    def open_catalog_item(self):
        # open group page
        if not (self.driver.current_url.endswith("/catalog/zhenshchinam/c1")):
            self.driver.find_element(By.LINK_TEXT, "Женщинам").click()
            self.driver.find_element(By.CSS_SELECTOR, ".catalog-list .gcell.is-inview:nth-child(2)").click()

    def test_add_to_cart_product(self):
        driver = self.driver
        driver.get("http://sanahunt.wezom.agency/")
        driver.maximize_window()
        driver.implicitly_wait(5)
        self.test_login()
        self.open_catalog_item()
        driver.find_element(By.CSS_SELECTOR, ".button[title='Купить']").click()
        try:
            WebDriverWait(driver, 10).until(
                ec.presence_of_element_located((By.CSS_SELECTOR, "body[class*='cart-open']")))
            waiter_notification_text = driver.find_element_by_css_selector(".cart-main").text

            print(colored("\n" + waiter_notification_text, 'green'))
        except NoSuchElementException:
            print("\nNo Cart opened")
        finally:
            time.sleep(5)
            print("\nEnd of test of item adding to cart testing")
